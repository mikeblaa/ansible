---
- hosts: maximus.maballou.com
  connection: local
  become: yes

  vars:
  vars_prompt:
    - name: "ipa_password"
      prompt: "Enter IPA password: "

  tasks:
  - name: enable third-party repositories
    command: dnf install fedora-workstation-repositories
  - name: enable google-chrome repository
    command: dnf config-manager --set-enabled google-chrome
  - name: install multiple packages
    action: >
      {{ ansible_pkg_mgr }} name={{ item }} state=present
    with_items:
      - autofs
      - brasero
      - cifs-utils
      - easytag
      - freeipa-client
      - gnucash
      - google-chrome-stable
      - gparted
      - ipa-client
      - jnettop
      - keepass
      - libsss_autofs
      - nfs-utils
      - python2-libselinux
      - python2-libsemanage
      - simple-scan
      - vim
  - name: set SElinux use_nfs_home_dirs
    seboolean:
      name: use_nfs_home_dirs
      state: yes
      persistent: yes
  - name: enabled NetworkManager-wait-online.service
    systemd:
      name: NetworkManager-wait-online.service
      enabled: yes
  - name: enable autofs
    systemd:
      name: autofs
      enabled: yes
      state: started
#  - name: setup FreeIPA
#    command: /usr/sbin/ipa-client-install --domain=maballou.com --server=ipa.maballou.com --realm=MABALLOU.COM --fixed-primary --principal admin --password {{ ipa_password }} --force-join --unattended --request-cert
#  - name: setup FreeIPA automount
#    command: /usr/sbin/ipa-client-automount -U
